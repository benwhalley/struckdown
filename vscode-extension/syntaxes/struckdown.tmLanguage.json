{
  "name": "Struckdown",
  "scopeName": "source.struckdown",
  "injectionSelector": "L:text.html.markdown",
  "patterns": [
    {
      "include": "#yaml-frontmatter"
    },
    {
      "include": "#section-separator"
    },
    {
      "include": "#struckdown-comments"
    },
    {
      "include": "#struckdown-xml-tags"
    },
    {
      "include": "#struckdown-placeholders"
    },
    {
      "include": "#struckdown-template-variables"
    },
    {
      "include": "#struckdown-django-tags"
    }
  ],
  "repository": {
    "yaml-frontmatter": {
      "patterns": [
        {
          "name": "meta.embedded.block.frontmatter.struckdown",
          "begin": "\\A(?=name:)",
          "while": "^(?!---#)",
          "patterns": [
            {
              "include": "source.yaml"
            }
          ]
        }
      ]
    },
    "section-separator": {
      "patterns": [
        {
          "name": "meta.separator.section.struckdown",
          "match": "^(---)(#)([a-zA-Z_][a-zA-Z0-9_]*)$",
          "captures": {
            "1": {
              "name": "punctuation.definition.separator.struckdown"
            },
            "2": {
              "name": "punctuation.definition.separator.hash.struckdown"
            },
            "3": {
              "name": "entity.name.section.struckdown"
            }
          }
        }
      ]
    },
    "struckdown-comments": {
      "patterns": [
        {
          "name": "comment.block.html.struckdown",
          "begin": "<!--",
          "end": "-->",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.comment.begin.struckdown"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.comment.end.struckdown"
            }
          }
        }
      ]
    },
    "struckdown-xml-tags": {
      "patterns": [
        {
          "name": "meta.tag.system.struckdown",
          "begin": "(<)(system)((?:\\s+(?:local|global|append|replace))*)(\\s*>)",
          "end": "(</)(system)(>)",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.struckdown" },
            "2": { "name": "entity.name.tag.system.struckdown" },
            "3": { "name": "entity.other.attribute-name.struckdown" },
            "4": { "name": "punctuation.definition.tag.end.struckdown" }
          },
          "endCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.struckdown" },
            "2": { "name": "entity.name.tag.system.struckdown" },
            "3": { "name": "punctuation.definition.tag.end.struckdown" }
          },
          "contentName": "meta.content.system.struckdown",
          "patterns": [
            { "include": "#struckdown-template-variables" },
            { "include": "#struckdown-django-tags" }
          ]
        },
        {
          "name": "meta.tag.checkpoint.self-closing.struckdown",
          "match": "(<)(checkpoint)(\\s*/?>|\\s*>)",
          "captures": {
            "1": { "name": "punctuation.definition.tag.begin.struckdown" },
            "2": { "name": "entity.name.tag.checkpoint.struckdown" },
            "3": { "name": "punctuation.definition.tag.end.struckdown" }
          }
        },
        {
          "name": "meta.tag.obliviate.self-closing.struckdown",
          "match": "(<)(obliviate)(\\s*/?>|\\s*>)",
          "captures": {
            "1": { "name": "punctuation.definition.tag.begin.struckdown" },
            "2": { "name": "entity.name.tag.obliviate.struckdown" },
            "3": { "name": "punctuation.definition.tag.end.struckdown" }
          }
        },
        {
          "name": "meta.tag.break.struckdown",
          "begin": "(<)(break)(\\s*>)",
          "end": "(</)(break)(>)",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.struckdown" },
            "2": { "name": "entity.name.tag.break.struckdown" },
            "3": { "name": "punctuation.definition.tag.end.struckdown" }
          },
          "endCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.struckdown" },
            "2": { "name": "entity.name.tag.break.struckdown" },
            "3": { "name": "punctuation.definition.tag.end.struckdown" }
          },
          "contentName": "string.unquoted.break-message.struckdown"
        },
        {
          "name": "meta.tag.break.self-closing.struckdown",
          "match": "(<)(break)(\\s*/>)",
          "captures": {
            "1": { "name": "punctuation.definition.tag.begin.struckdown" },
            "2": { "name": "entity.name.tag.break.struckdown" },
            "3": { "name": "punctuation.definition.tag.end.struckdown" }
          }
        },
        {
          "name": "meta.tag.include.struckdown",
          "match": "(<)(include)(\\s+)(src)(=)(\"[^\"]*\"|'[^']*')(\\s*/>)",
          "captures": {
            "1": { "name": "punctuation.definition.tag.begin.struckdown" },
            "2": { "name": "entity.name.tag.include.struckdown" },
            "3": { "name": "text.struckdown" },
            "4": { "name": "entity.other.attribute-name.struckdown" },
            "5": { "name": "punctuation.separator.key-value.struckdown" },
            "6": { "name": "string.quoted.struckdown" },
            "7": { "name": "punctuation.definition.tag.end.struckdown" }
          }
        }
      ]
    },
    "struckdown-placeholders": {
      "patterns": [
        {
          "name": "meta.placeholder.struckdown",
          "begin": "\\[\\[",
          "end": "\\]\\]",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.placeholder.begin.struckdown"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.placeholder.end.struckdown"
            }
          },
          "patterns": [
            {
              "name": "meta.placeholder.action.struckdown",
              "begin": "(@)([a-zA-Z_][a-zA-Z0-9_]*)(\\:)",
              "end": "(?=\\]\\])",
              "beginCaptures": {
                "1": { "name": "punctuation.definition.action.struckdown" },
                "2": { "name": "entity.name.function.action.struckdown" },
                "3": { "name": "punctuation.separator.type.struckdown" }
              },
              "patterns": [
                {
                  "name": "variable.other.placeholder.name.struckdown",
                  "match": "[^|\\]\\[]+"
                },
                {
                  "name": "punctuation.separator.options.struckdown",
                  "match": "\\|"
                }
              ]
            },
            {
              "name": "meta.placeholder.typed.struckdown",
              "match": "(?x)\n                (\\d+:\\d+\\*|\\d+\\*|\\*)?      # Optional multiplier: 2:4*, 3*, or *\n                (?:\n                  (think|speak|boolean|bool|int|json|number|pick|date|datetime|time|duration|extract)  # Type prefix\n                  (\\:)\n                )?",
              "captures": {
                "1": {
                  "name": "keyword.operator.multiplier.struckdown"
                },
                "2": {
                  "name": "storage.type.struckdown"
                },
                "3": {
                  "name": "punctuation.separator.type.struckdown"
                }
              }
            },
            {
              "name": "meta.placeholder.pick.struckdown",
              "begin": "(pick)(\\:)([^|\\]]+)(\\|)",
              "end": "(?=\\]\\])",
              "beginCaptures": {
                "1": {
                  "name": "storage.type.pick.struckdown"
                },
                "2": {
                  "name": "punctuation.separator.type.struckdown"
                },
                "3": {
                  "name": "variable.other.placeholder.name.struckdown"
                },
                "4": {
                  "name": "punctuation.separator.options.struckdown"
                }
              },
              "patterns": [
                {
                  "name": "constant.language.option.struckdown",
                  "match": "[^,\\]\\[]+"
                },
                {
                  "name": "punctuation.separator.option.struckdown",
                  "match": ","
                }
              ]
            },
            {
              "name": "variable.other.placeholder.struckdown",
              "match": "[^\\[\\]:]+"
            }
          ]
        }
      ]
    },
    "struckdown-template-variables": {
      "patterns": [
        {
          "name": "variable.other.template.struckdown",
          "begin": "\\{\\{",
          "end": "\\}\\}",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.template.begin.struckdown"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.template.end.struckdown"
            }
          },
          "patterns": [
            {
              "name": "variable.other.readwrite.struckdown",
              "match": "[^\\{\\}]+"
            }
          ]
        }
      ]
    },
    "struckdown-django-tags": {
      "patterns": [
        {
          "name": "meta.tag.django.struckdown",
          "begin": "(\\{%)([-+]?)",
          "end": "([-+]?)(%\\})",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.tag.begin.django.struckdown" },
            "2": { "name": "keyword.operator.whitespace.django.struckdown" }
          },
          "endCaptures": {
            "1": { "name": "keyword.operator.whitespace.django.struckdown" },
            "2": { "name": "punctuation.definition.tag.end.django.struckdown" }
          },
          "patterns": [
            {
              "name": "keyword.control.django.struckdown",
              "match": "\\b(if|else|elif|endif|for|endfor|include|extends|block|endblock|set|macro|endmacro|raw|endraw|import|from|as|with|endwith|call|endcall|filter|endfilter|autoescape|endautoescape)\\b"
            },
            {
              "name": "variable.other.django.struckdown",
              "match": "[a-zA-Z_][a-zA-Z0-9_]*"
            },
            {
              "name": "string.quoted.single.django.struckdown",
              "match": "'[^']*'"
            },
            {
              "name": "string.quoted.double.django.struckdown",
              "match": "\"[^\"]*\""
            }
          ]
        }
      ]
    }
  }
}
