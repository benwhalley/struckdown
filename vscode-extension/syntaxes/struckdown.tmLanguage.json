{
  "name": "Struckdown",
  "scopeName": "source.struckdown",
  "injectionSelector": "L:text.html.markdown",
  "patterns": [
    {
      "include": "#yaml-frontmatter"
    },
    {
      "include": "#section-separator"
    },
    {
      "include": "#struckdown-comments"
    },
    {
      "include": "#struckdown-keywords"
    },
    {
      "include": "#struckdown-placeholders"
    },
    {
      "include": "#struckdown-template-variables"
    },
    {
      "include": "#struckdown-django-tags"
    }
  ],
  "repository": {
    "yaml-frontmatter": {
      "patterns": [
        {
          "name": "meta.embedded.block.frontmatter.struckdown",
          "begin": "\\A(?=name:)",
          "while": "^(?!---#)",
          "patterns": [
            {
              "include": "source.yaml"
            }
          ]
        }
      ]
    },
    "section-separator": {
      "patterns": [
        {
          "name": "meta.separator.section.struckdown",
          "match": "^(---)(#)([a-zA-Z_][a-zA-Z0-9_]*)$",
          "captures": {
            "1": {
              "name": "punctuation.definition.separator.struckdown"
            },
            "2": {
              "name": "punctuation.definition.separator.hash.struckdown"
            },
            "3": {
              "name": "entity.name.section.struckdown"
            }
          }
        }
      ]
    },
    "struckdown-comments": {
      "patterns": [
        {
          "name": "comment.block.html.struckdown",
          "begin": "<!--",
          "end": "-->",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.comment.begin.struckdown"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.comment.end.struckdown"
            }
          }
        }
      ]
    },
    "struckdown-keywords": {
      "patterns": [
        {
          "name": "meta.block.system.struckdown",
          "begin": "¡(SYSTEM|IMPORTANT)(\\+)?",
          "end": "/END",
          "beginCaptures": {
            "0": {
              "name": "keyword.control.system.struckdown"
            }
          },
          "endCaptures": {
            "0": {
              "name": "keyword.control.end.struckdown"
            }
          },
          "patterns": [
            {
              "include": "#struckdown-template-variables"
            },
            {
              "include": "#struckdown-django-tags"
            }
          ]
        },
        {
          "name": "meta.block.header.struckdown",
          "begin": "¡HEADER(\\+)?",
          "end": "/END",
          "beginCaptures": {
            "0": {
              "name": "keyword.control.header.struckdown"
            }
          },
          "endCaptures": {
            "0": {
              "name": "keyword.control.end.struckdown"
            }
          },
          "patterns": [
            {
              "include": "#struckdown-template-variables"
            },
            {
              "include": "#struckdown-django-tags"
            }
          ]
        },
        {
          "name": "keyword.control.obliviate.struckdown",
          "match": "¡(OBLIVIATE|SEGMENT)"
        }
      ]
    },
    "struckdown-placeholders": {
      "patterns": [
        {
          "name": "meta.placeholder.struckdown",
          "begin": "\\[\\[",
          "end": "\\]\\]",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.placeholder.begin.struckdown"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.placeholder.end.struckdown"
            }
          },
          "patterns": [
            {
              "name": "meta.placeholder.typed.struckdown",
              "match": "(?x)\n                (\\d+:\\d+\\*|\\d+\\*|\\*)?      # Optional multiplier: 2:4*, 3*, or *\n                (?:\n                  (think|speak|boolean|bool|int|json|number|pick)  # Type prefix\n                  (:)\n                )?",
              "captures": {
                "1": {
                  "name": "keyword.operator.multiplier.struckdown"
                },
                "2": {
                  "name": "storage.type.struckdown"
                },
                "3": {
                  "name": "punctuation.separator.type.struckdown"
                }
              }
            },
            {
              "name": "meta.placeholder.pick.struckdown",
              "begin": "(pick)(\\:)([^|\\]]+)(\\|)",
              "end": "(?=\\]\\])",
              "beginCaptures": {
                "1": {
                  "name": "storage.type.pick.struckdown"
                },
                "2": {
                  "name": "punctuation.separator.type.struckdown"
                },
                "3": {
                  "name": "variable.other.placeholder.name.struckdown"
                },
                "4": {
                  "name": "punctuation.separator.options.struckdown"
                }
              },
              "patterns": [
                {
                  "name": "constant.language.option.struckdown",
                  "match": "[^,\\]\\[]+"
                },
                {
                  "name": "punctuation.separator.option.struckdown",
                  "match": ","
                }
              ]
            },
            {
              "name": "variable.other.placeholder.struckdown",
              "match": "[^\\[\\]:]+"
            }
          ]
        }
      ]
    },
    "struckdown-template-variables": {
      "patterns": [
        {
          "name": "variable.other.template.struckdown",
          "begin": "\\{\\{",
          "end": "\\}\\}",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.template.begin.struckdown"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.template.end.struckdown"
            }
          },
          "patterns": [
            {
              "name": "variable.other.readwrite.struckdown",
              "match": "[^\\{\\}]+"
            }
          ]
        }
      ]
    },
    "struckdown-django-tags": {
      "patterns": [
        {
          "name": "meta.tag.django.struckdown",
          "begin": "\\{%",
          "end": "%\\}",
          "beginCaptures": {
            "0": {
              "name": "punctuation.definition.tag.begin.struckdown"
            }
          },
          "endCaptures": {
            "0": {
              "name": "punctuation.definition.tag.end.struckdown"
            }
          },
          "patterns": [
            {
              "name": "keyword.control.django.struckdown",
              "match": "[^\\{%}]+"
            }
          ]
        }
      ]
    }
  }
}
